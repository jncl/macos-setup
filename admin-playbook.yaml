---

- name: Admin playbook
  hosts: all
  gather_facts: true

  vars_files:
    - vars/global_vars.yaml
    - vars/osx_global_defaults.yaml
    - vars/osx_local_defaults.yaml
    - vars/admin_global_vars.yaml
    - vars/{{ 'admin_' ~ computer.model ~ '_vars' }}.yaml

  vars_prompt:
    - name: mas_password
      prompt: Enter password for Apple ID {{ user.mas_email }}
      confirm: true
      private: true
    - name: user.password
      prompt: Enter password for User {{ user.name }}
      confirm: true
      private: true

  handlers:
    - name: Include Handlers
      ansible.builtin.import_tasks: handlers/main.yaml

  pre_tasks:
    - name: Create variables to be used in the following Roles & Tasks
      ansible.builtin.include_tasks: tasks/admin-pre-task.yaml

  roles:
    - role: geerlingguy.mac.homebrew
      when: homebrew_cask_apps is defined or homebrew_installed_packages is defined
      tags: homebrew
    - role: geerlingguy.mac.mas
      when: mas_installed_apps is defined
      tags: mas
    - role: geerlingguy.mac.dock
      when: dockitems_remove is defined or dockitems_persist is defined
      tags: dock

  tasks:
    - name: Include other-casks
      ansible.builtin.include_tasks: tasks/install-other-casks.yaml
      tags: casks
    - name: Include set-defaults
      ansible.builtin.include_tasks: tasks/set-defaults.yaml
      tags: defaults
    - name: Include admin-config
      ansible.builtin.include_tasks: tasks/admin-config.yaml
      tags: config
    - name: Include config-hardware
      ansible.builtin.include_tasks: tasks/config-hardware.yaml
      tags: hardware
    - name: Include set-hostname
      ansible.builtin.include_tasks: tasks/set-hostname.yaml
      tags: hostname
    - name: Include create-user
      ansible.builtin.include_tasks: tasks/create-user.yaml
      tags: user
    - name: Include change-ownership
      ansible.builtin.include_tasks: tasks/change-ownership.yaml
      tags: owner
